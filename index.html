<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RBX-Control | Hosting Dashboard</title>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg: #0d1117; --card: #161b22; --border: #30363d;
            --accent: #3b82f6; --success: #238636; --danger: #da3633;
            --text: #c9d1d9; --text-dim: #8b949e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: var(--bg); color: var(--text); 
            font-family: 'Inter', sans-serif; 
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; overflow: hidden;
        }

        /* Container & Cards */
        .container {
            background: var(--card); border: 1px solid var(--border);
            border-radius: 12px; width: 100%; max-width: 450px;
            padding: 40px; position: relative;
        }

        h1 { font-size: 24px; color: white; margin-bottom: 8px; text-align: center; }
        p.subtitle { color: var(--text-dim); font-size: 14px; text-align: center; margin-bottom: 30px; }

        /* Formular Elemente */
        input {
            width: 100%; padding: 12px; background: #010409; border: 1px solid var(--border);
            border-radius: 6px; color: white; margin-bottom: 15px; outline: none; font-size: 16px;
        }
        input:focus { border-color: var(--accent); }

        button {
            width: 100%; padding: 12px; border: none; border-radius: 6px; 
            font-weight: 600; cursor: pointer; transition: 0.2s; font-size: 15px;
        }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { filter: brightness(1.2); }
        .btn-success { background: var(--success); color: white; margin-top: 10px; }
        .btn-danger { background: var(--danger); color: white; }

        /* Verifizierungschritt */
        #verifyStep, #dashboardView { display: none; }
        
        .code-box {
            background: #010409; padding: 15px; border-radius: 8px; border: 1px dashed var(--accent);
            color: var(--accent); font-family: 'JetBrains Mono', monospace;
            font-size: 22px; text-align: center; margin: 20px 0;
        }

        .status-msg { font-size: 13px; text-align: center; margin-top: 15px; min-height: 20px; }
        .loader { color: var(--accent); display: none; margin-bottom: 10px; }

        /* Dashboard spezifisch */
        .dashboard-container { max-width: 800px; display: none; width: 90%; background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 30px; }
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .console {
            background: #010409; border-radius: 6px; padding: 15px; height: 180px; 
            overflow-y: auto; font-family: 'JetBrains Mono'; font-size: 12px; color: #8b949e; margin-bottom: 15px;
        }
    </style>
</head>
<body>

    <!-- LOGIN & VERIFY CARD -->
    <div id="authView" class="container">
        <h1>Server Hosting</h1>
        <p class="subtitle">Verwalte deine Notruf-Server Instanz</p>

        <!-- Login: Name eingeben -->
        <div id="loginStep">
            <input type="text" id="username" placeholder="Roblox Benutzername">
            <button class="btn-primary" onclick="getVerificationCode()">Account finden</button>
        </div>

        <!-- Verify: Code zeigen -->
        <div id="verifyStep">
            <p style="text-align: center; font-size: 14px;">Kopiere diesen Code in deine <strong>Roblox Bio</strong> (Über mich):</p>
            <div id="codeDisplay" class="code-box">Lade...</div>
            <button class="btn-success" id="btnVerify" onclick="verifyEverything()">Bio & Gamepass prüfen</button>
        </div>

        <div class="status-msg" id="statusLabel"></div>
        <div id="loader" class="status-msg loader"><i class="fa-solid fa-spinner fa-spin"></i> Kontaktiere Roblox...</div>
    </div>

    <!-- MAIN DASHBOARD VIEW -->
    <div id="dashboardView" class="dashboard-container">
        <div class="dashboard-header">
            <h2><i class="fa-solid fa-gauge-high"></i> Host Panel</h2>
            <div><span style="color:var(--success)">●</span> Online | <strong id="displayName">Admin</strong></div>
        </div>

        <div class="grid">
            <div>
                <div class="console" id="logBox">
                    [SYSTEM] Dashboard gestartet...<br>
                    [SYSTEM] Verbindung zum Server stabil.
                </div>
                <button class="btn-primary" style="height: 60px; font-size: 18px;" onclick="saveCommand('START_SERVER')">
                    <i class="fa-solid fa-play"></i> SERVER STARTEN (RESERVE)
                </button>
            </div>
            
            <div>
                <p style="font-size: 12px; margin-bottom: 5px; color: var(--text-dim);">Global Message senden:</p>
                <input type="text" id="gMessage" placeholder="An alle Spieler..." style="margin-bottom: 10px;">
                <button class="btn-primary" onclick="saveCommand('MESSAGE', document.getElementById('gMessage').value)">
                    <i class="fa-solid fa-bullhorn"></i> Senden
                </button>
                <br><br>
                <button class="btn-danger" style="background: rgba(218, 54, 51, 0.1); border: 1px solid var(--danger);" onclick="saveCommand('SHUTDOWN')">
                    <i class="fa-solid fa-power-off"></i> Server Instanz schließen
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- KONFIGURATION (VON DIR ANPASSEN) ---
        const GAS_URL = "DEINE_GOOGLE_APPS_SCRIPT_URL_HIER"; // WICHTIG: Deine Google URL
        
        let currentUsername = "";
        let currentUserId = "";

        // UI Element Shortcuts
        const statusLabel = document.getElementById('statusLabel');
        const loader = document.getElementById('loader');

        async function getVerificationCode() {
            currentUsername = document.getElementById('username').value;
            if(!currentUsername) return alert("Bitte Username eingeben!");

            setLoading(true);
            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action: "getVerifyCode", username: currentUsername })
                });
                const data = await response.json();
                
                document.getElementById('codeDisplay').innerText = data.code;
                document.getElementById('loginStep').style.display = 'none';
                document.getElementById('verifyStep').style.display = 'block';
            } catch (e) {
                statusLabel.innerText = "Fehler beim Laden des Codes.";
            }
            setLoading(false);
        }

        async function verifyEverything() {
            setLoading(true);
            statusLabel.innerText = "Prüfe Bio und Gamepass...";
            
            try {
                const response = await fetch(GAS_URL, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        action: "verifyAndCheck", 
                        username: currentUsername 
                    })
                });
                const data = await response.json();

                if (data.success) {
                    currentUserId = data.userId;
                    showDashboard();
                } else {
                    statusLabel.style.color = "var(--danger)";
                    statusLabel.innerText = data.message;
                }
            } catch (e) {
                statusLabel.innerText = "Netzwerkfehler beim Verifizieren.";
            }
            setLoading(false);
        }

        async function saveCommand(type, extra = "") {
            addLog("Befehl gesendet: " + type);
            await fetch(GAS_URL, {
                method: 'POST',
                body: JSON.stringify({
                    action: "saveCommand",
                    userId: currentUserId,
                    command: { action: type, data: extra, time: Date.now() }
                })
            });
            if(extra) document.getElementById('gMessage').value = "";
        }

        function showDashboard() {
            document.getElementById('authView').style.display = 'none';
            document.getElementById('dashboardView').style.display = 'block';
            document.getElementById('displayName').innerText = currentUsername;
        }

        function addLog(msg) {
            const box = document.getElementById('logBox');
            const time = new Date().toLocaleTimeString();
            box.innerHTML += `<div>[${time}] ${msg}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        function setLoading(state) {
            loader.style.display = state ? "block" : "none";
            document.getElementById('btnVerify').disabled = state;
        }
    </script>
</body>
</html>
