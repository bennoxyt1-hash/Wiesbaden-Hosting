<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Notruf Hosting | Dashboard</title>
    <style>
        :root { --bg: #0f121a; --card: #1a1d2b; --accent: #007bff; --success: #28a745; --text: #ffffff; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .box { background: var(--card); padding: 30px; border-radius: 12px; width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; }
        input { width: 100%; padding: 12px; margin: 15px 0; border-radius: 6px; border: 1px solid #333; background: #000; color: white; box-sizing: border-box; }
        button { width: 100%; padding: 12px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; background: var(--accent); color: white; }
        #verifyZone, #dashboard { display: none; }
        .code-display { font-size: 24px; color: #00ff88; font-family: monospace; margin: 20px 0; padding: 10px; border: 2px dashed #00ff88; }
        .log-box { background: #000; padding: 10px; border-radius: 4px; font-size: 12px; height: 100px; overflow-y: auto; text-align: left; margin-top: 15px; color: #aaa; }
    </style>
</head>
<body>

    <!-- SCHRITT 1: Login -->
    <div id="login" class="box">
        <h2>Notruf Hamburg Hosting</h2>
        <p>Gib deinen Roblox Usernamen ein:</p>
        <input type="text" id="rbxName" placeholder="Roblox Username">
        <button onclick="startVerify()">Verifizierung starten</button>
    </div>

    <!-- SCHRITT 2: Verifizierung -->
    <div id="verifyZone" class="box">
        <h2>Verifizierung</h2>
        <p>Kopiere diesen Code in deine Roblox "Über mich" (Bio) Beschreibung:</p>
        <div class="code-display" id="codeText">CODE-1234</div>
        <button onclick="checkAccount()" id="btnCheck">Bio & Gamepass prüfen</button>
        <p id="error" style="color: #ff4444; font-size: 13px;"></p>
    </div>

    <!-- SCHRITT 3: Das eigentliche Dashboard (txAdmin Style) -->
    <div id="dashboard" class="box" style="width: 600px;">
        <h2>Hosting Dashboard</h2>
        <p>Angemeldet als: <strong id="userLabel"></strong></p>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <button style="background: var(--success);" onclick="sendToGAS('START_SERVER')">SERVER STARTEN</button>
            <button style="background: #dc3545;" onclick="sendToGAS('STOP_SERVER')">SERVER STOPPEN</button>
        </div>
        <input type="text" id="gmsg" placeholder="Nachricht an alle...">
        <button onclick="sendToGAS('MESSAGE', document.getElementById('gmsg').value)">Global Message senden</button>
        <div class="log-box" id="logs">Status: Bereit...</div>
    </div>

    <script>
        // HIER DEINE DATEN EINTRAGEN
        const GAS_URL = "https://script.google.com/macros/s/AKfycbwFPAdde56q51Mh87PLF_wbEyXGg4e0Abw182YPPZ1cp7hQgtfi2rp7yGtNNtySA8xFqA/exec"; 
        const GAMEPASS_ID = 1702894929; // Deine 100 Robux Gamepass ID
        const PROXY = "https://roproxy.com"; 

        let rbxName = "";
        let rbxId = "";

        // 1. Code vom GAS holen
        async function startVerify() {
            rbxName = document.getElementById('rbxName').value;
            if(!rbxName) return;

            const res = await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({ action: "getVerifyCode", username: rbxName })
            });
            const data = await res.json();
            document.getElementById('codeText').innerText = data.code;
            document.getElementById('login').style.display = 'none';
            document.getElementById('verifyZone').style.display = 'block';
        }

        // 2. Account & Kauf prüfen (Via RoProxy)
        async function checkAccount() {
            const errorTxt = document.getElementById('error');
            errorTxt.innerText = "Prüfe...";
            
            try {
                // Get UserId
                const uRes = await fetch(`${PROXY}/users/v1/usernames/users`, {
                    method: "POST", headers: {"Content-Type":"application/json"},
                    body: JSON.stringify({usernames: [rbxName]})
                });
                const uData = await uRes.json();
                rbxId = uData.data[0].id;

                // Check Bio
                const bRes = await fetch(`${PROXY}/users/v1/users/${rbxId}`);
                const bData = await bRes.json();
                const neededCode = document.getElementById('codeText').innerText;
                
                if(!bData.description.includes(neededCode)) {
                    errorTxt.innerText = "Code nicht in Bio gefunden!"; return;
                }

                // Check Gamepass (Item im Inventar?)
                const pRes = await fetch(`${PROXY}/inventory/v1/users/${rbxId}/items/1/${GAMEPASS_ID}`);
                const pData = await pRes.json();
                
                if(pData.data.length === 0) {
                    errorTxt.innerText = "Du besitzt den 100 Robux Gamepass nicht!"; return;
                }

                // ERFOLG -> Zeige Dashboard
                document.getElementById('verifyZone').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                document.getElementById('userLabel').innerText = rbxName;

            } catch(e) { errorTxt.innerText = "Fehler bei der Abfrage."; }
        }

        // 3. Befehl an das GAS speichern
        async function sendToGAS(type, val = "") {
            addLog("Sende Befehl: " + type);
            await fetch(GAS_URL, {
                method: "POST",
                body: JSON.stringify({
                    action: "saveCommand",
                    userId: rbxId,
                    command: { action: type, data: val }
                })
            });
            addLog("Befehl wurde gespeichert.");
        }

        function addLog(msg) {
            document.getElementById('logs').innerHTML += "<br>> " + msg;
        }
    </script>
</body>
</html>
